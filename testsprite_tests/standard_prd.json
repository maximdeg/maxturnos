{
  "meta": {
    "project": "MaxTurnos Medical Appointment Booking System",
    "date": "2026-01-21",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "MaxTurnos is a modern, multi-provider medical appointment booking system built with Next.js and React. It allows patients to book appointments online without registration, while healthcare providers manage their schedules, appointments, and profiles through an admin dashboard. The system integrates WhatsApp for appointment notifications and uses secure authentication for providers.",
  "core_goals": [
    "Enable patients to easily book medical appointments through an intuitive online form.",
    "Provide healthcare providers with secure authentication and comprehensive profile management.",
    "Implement dynamic availability calculation respecting provider work schedules and unavailable times.",
    "Ensure seamless communication by integrating WhatsApp notifications for appointment confirmation and cancellation.",
    "Maintain data integrity and security via robust validation, authentication, and cancellation policies.",
    "Offer a responsive and accessible user interface across devices and browsers."
  ],
  "key_features": [
    "Dynamic multi-step appointment booking form with validation and support for different visit types and health insurances.",
    "Provider authentication system including registration, login, email verification, and session management via JWT.",
    "Provider dashboard for managing personal profiles, work schedules, unavailable days, appointments calendar, and password changes.",
    "Comprehensive appointment management: creation, cancellation (with 12-hour policy), viewing details, and sending notifications.",
    "Real-time available times calculation considering provider schedules, existing appointments, and unavailable periods.",
    "Integration with WhatsApp API (Whapi) for automatic confirmation and cancellation messages to patients.",
    "Email service using Nodemailer to handle provider email verification securely.",
    "Robust rate limiting and caching mechanisms to optimize performance and prevent abuse.",
    "Structured logging for monitoring and debugging during development and production.",
    "Health insurance API providing valid insurance options filtered by visit type."
  ],
  "user_flow_summary": [
    "Patient visits provider public page, selects 'Agendar Visita', completes multi-step booking form, and submits appointment; receives WhatsApp confirmation and accesses appointment details.",
    "Provider registers an account, verifies email via received link, logs in, sets work schedule and unavailable dates, manages appointments via dashboard.",
    "Patient cancels appointment using a secure tokenized link prior to the 12-hour cutoff; appointment status updates and cancellation notifications are sent via WhatsApp.",
    "Provider logs into dashboard to update profile information, change password, and block unavailable dates/time frames.",
    "System calculates available time slots dynamically in 20-minute intervals based on work schedule, existing appointments, and provider unavailability, updating the booking form accordingly."
  ],
  "validation_criteria": [
    "All API endpoints validate inputs, return appropriate HTTP status codes, and handle errors gracefully.",
    "Multi-step booking form enforces field validation and prevents submission with incomplete or invalid data.",
    "Provider authentication enforces email verification before allowing login and maintains secure session management.",
    "Appointment booking respects provider schedules, prevents double-booking, and prohibits cancellation within 12 hours of the appointment.",
    "WhatsApp and email notifications are sent reliably for appointment creation, confirmation, email verification, and cancellation events.",
    "Provider dashboard accurately reflects appointments, calendar data, and profile changes immediately upon user action.",
    "Rate limiting is effective to prevent abuse of public endpoints, with fallback mechanisms in place.",
    "UI components maintain responsiveness, accessibility standards (keyboard navigation, screen reader compatibility, color contrast), and function correctly across supported browsers.",
    "Data consistency is ensured with database transactions and rollback in case of operation failures."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "Next.js 15",
      "React 19",
      "PostgreSQL",
      "Tailwind CSS",
      "shadcn/ui",
      "React Hook Form",
      "Zod",
      "TanStack Query",
      "Whapi (WhatsApp API)",
      "Nodemailer",
      "JWT",
      "bcrypt",
      "Upstash Redis",
      "Pino (Logging)"
    ],
    "features": [
      {
        "name": "Appointment Booking Form",
        "description": "Formulario principal para que los pacientes reserven citas con proveedores de salud. Incluye validación de datos, selección de fecha/hora, tipo de consulta/práctica, obra social y envío de confirmación por WhatsApp.",
        "files": [
          "components/agendar-visita/AppointmentForm.tsx",
          "components/agendar-visita/AvailableTimesComponentImproved.tsx",
          "app/[username]/agendar-visita/page.tsx"
        ]
      },
      {
        "name": "Provider Authentication",
        "description": "Sistema de autenticación para proveedores con registro, login, verificación de email mediante Nodemailer y gestión de sesiones con JWT.",
        "files": [
          "app/api/auth/register/route.ts",
          "app/api/auth/login/route.ts",
          "app/api/auth/verify-email/route.ts",
          "app/proveedor/register/page.tsx",
          "app/proveedor/login/page.tsx",
          "app/[username]/verificar-email/page.tsx",
          "lib/auth.ts"
        ]
      },
      {
        "name": "Provider Profile Management",
        "description": "Panel de administración para proveedores donde pueden ver sus citas, gestionar su perfil, horarios de trabajo, días no laborables y cambiar contraseña.",
        "files": [
          "app/proveedor/perfil/page.tsx",
          "app/proveedor/perfil/layout.tsx",
          "app/api/proveedor/profile/route.ts",
          "app/api/proveedor/profile/password/route.ts",
          "app/api/proveedor/appointments/route.ts",
          "app/api/proveedor/calendar/route.ts",
          "app/api/proveedor/work-schedule/route.ts",
          "app/api/proveedor/unavailable-days/route.ts"
        ]
      },
      {
        "name": "Appointment Management",
        "description": "Sistema completo de gestión de citas: creación, cancelación, visualización de detalles y envío de notificaciones por WhatsApp.",
        "files": [
          "app/api/appointments/create/route.ts",
          "app/api/appointments/[id]/cancel/route.ts",
          "app/api/appointments/[id]/route.ts",
          "app/api/appointments/date/[date]/route.ts",
          "app/[username]/cita/[id]/page.tsx",
          "lib/cancellation-token.ts"
        ]
      },
      {
        "name": "Available Times API",
        "description": "Endpoint que calcula y devuelve los horarios disponibles para un proveedor en una fecha específica, considerando horarios de trabajo, citas existentes y días no laborables.",
        "files": [
          "app/api/available-times/[date]/route.ts"
        ]
      },
      {
        "name": "Work Schedule Management",
        "description": "Gestión de horarios de trabajo de proveedores, incluyendo días de la semana y rangos de tiempo disponibles.",
        "files": [
          "app/api/provider/[username]/work-schedule/route.ts",
          "app/api/proveedor/work-schedule/route.ts"
        ]
      },
      {
        "name": "WhatsApp Integration",
        "description": "Integración con Whapi para enviar mensajes de confirmación y cancelación de citas automáticamente a los pacientes.",
        "files": [
          "lib/whatsapp.ts"
        ]
      },
      {
        "name": "Email Service",
        "description": "Servicio de envío de emails usando Nodemailer con Google SMTP para verificación de cuentas de proveedores.",
        "files": [
          "lib/email.ts"
        ]
      },
      {
        "name": "Database Transactions",
        "description": "Sistema de transacciones para operaciones críticas que garantiza consistencia de datos y rollback automático en caso de error.",
        "files": [
          "lib/db-transactions.ts",
          "lib/db.ts"
        ]
      },
      {
        "name": "Rate Limiting",
        "description": "Sistema de rate limiting para proteger endpoints públicos contra abuso, usando Upstash Redis o fallback en memoria.",
        "files": [
          "lib/rate-limit.ts"
        ]
      },
      {
        "name": "Caching System",
        "description": "Sistema de caché para optimizar consultas frecuentes como horarios disponibles, obras sociales y horarios de trabajo, usando Redis o LRU cache en memoria.",
        "files": [
          "lib/cache.ts"
        ]
      },
      {
        "name": "Structured Logging",
        "description": "Sistema de logging estructurado usando Pino para desarrollo y producción, con loggers especializados por contexto.",
        "files": [
          "lib/logger.ts"
        ]
      },
      {
        "name": "Health Insurance API",
        "description": "Endpoint que devuelve la lista de obras sociales disponibles para selección en el formulario de citas.",
        "files": [
          "app/api/health-insurance/route.ts",
          "data/obras-sociales.json"
        ]
      },
      {
        "name": "Provider Landing Page",
        "description": "Página de aterrizaje dinámica para cada proveedor basada en su username, mostrando información del proveedor y enlace al formulario de citas.",
        "files": [
          "app/[username]/page.tsx"
        ]
      },
      {
        "name": "UI Components",
        "description": "Componentes reutilizables de UI basados en shadcn/ui y Radix UI, incluyendo formularios, calendarios, botones, inputs, selects y más.",
        "files": [
          "components/ui/button.tsx",
          "components/ui/input.tsx",
          "components/ui/form.tsx",
          "components/ui/calendar.tsx",
          "components/ui/select.tsx",
          "components/ui/card.tsx",
          "components/ui/label.tsx",
          "components/ui/popover.tsx",
          "components/ui/tabs.tsx",
          "components/ui/alert.tsx",
          "components/ui/badge.tsx"
        ]
      },
      {
        "name": "Type Definitions",
        "description": "Definiciones de tipos TypeScript compartidas para toda la aplicación.",
        "files": [
          "lib/types.ts"
        ]
      },
      {
        "name": "Utility Functions",
        "description": "Funciones utilitarias para formateo, validación y operaciones comunes.",
        "files": [
          "lib/utils.ts"
        ]
      },
      {
        "name": "Middleware",
        "description": "Middleware de Next.js para manejo de rutas protegidas y autenticación.",
        "files": [
          "middleware.ts"
        ]
      }
    ]
  }
}
